/* GptMeasurement HouseHold ImplementationValidator LegacyLayer SignalsAbs SignalsAutoInsertion SignalsBsc SignalsIds SignalsTvp SignalsVlp TimeConfig */
(()=>{var Se=Object.defineProperty,Jr=Object.defineProperties,Zr=Object.getOwnPropertyDescriptor,to=Object.getOwnPropertyDescriptors;var zt=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var he=(o,t,e)=>t in o?Se(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,_=(o,t)=>{for(var e in t||(t={}))Qe.call(t,e)&&he(o,e,t[e]);if(zt)for(var e of zt(t))Be.call(t,e)&&he(o,e,t[e]);return o},vt=(o,t)=>Jr(o,to(t)),n=(o,t)=>Se(o,"name",{value:t,configurable:!0});var $e=(o,t)=>{var e={};for(var r in o)Qe.call(o,r)&&t.indexOf(r)<0&&(e[r]=o[r]);if(o!=null&&zt)for(var r of zt(o))t.indexOf(r)<0&&Be.call(o,r)&&(e[r]=o[r]);return e};var s=(o,t,e,r)=>{for(var i=r>1?void 0:r?Zr(t,e):t,d=o.length-1,u;d>=0;d--)(u=o[d])&&(i=(r?u(t,e,i):u(i))||i);return r&&i&&Se(t,e,i),i};var g=(o,t,e)=>(he(o,typeof t!="symbol"?t+"":t,e),e);var A=(o,t,e)=>new Promise((r,i)=>{var d=f=>{try{m(e.next(f))}catch(h){i(h)}},u=f=>{try{m(e.throw(f))}catch(h){i(h)}},m=f=>f.done?r(f.value):Promise.resolve(f.value).then(d,u);m((e=e.apply(o,t)).next())});var a={"21801468956":{adServerId:39,customTracking:{c1:{type:"targeting",key:"type"},c2:{type:"targeting",key:"ctype"},c3:{type:"targeting",key:"primarysection"},c4:{type:"targeting",key:"sections"},c5:{type:"targeting",key:"vidonpage"},c6:{type:"targeting",key:"category"},c7:{type:"targeting",key:"aid"},c8:{type:"targeting",key:"hb_bidder"},c9:{type:"targeting",key:"LyticsSegments"},c10:{type:"targeting",key:"tags"}}}};var Te={queueAdRequest:o=>{var t;try{(t=o.callback)==null||t.call(o),o.callback=null}catch(e){}},defineSlot:(o,t)=>{},adRendered:(o,t)=>{},adRemoved:o=>{},getTargeting:o=>({}),addEventListener:(o,t)=>{},removeEventListener:(o,t)=>{},toggleDebugMode:()=>{console.log("%c[UT-DEBUG]%c Debug mode is not available for this tag.","color: red","color: intial")},onSlotVisibleForTime:(o,t,e)=>{}};var Ae=class Ae{constructor(){g(this,"isEntryModule",!0)}};n(Ae,"EntryModule");var x=Ae;var Yt=class Yt{constructor(t){g(this,"_error");g(this,"_message","unknown");g(this,"_trace",[]);if(t instanceof Yt)return t;t instanceof Error&&(this._error=t,this._message=t.message)}get error(){return this._error}get message(){return this._message}get trace(){return this._trace}addToTrace(t){this.trace.unshift(t)}};n(Yt,"TracedError");var Ct=Yt;var Re=class Re{constructor(t,e){g(this,"window");g(this,"dvtag");g(this,"modules",new Map);g(this,"errorHandlers",[]);g(this,"errors",[]);var r;this.window=e,this.window.dvtag=(r=this.window.dvtag)!=null?r:{},this.dvtag=this.window.dvtag,this.dvtag._core=this;for(let[i,d]of Object.entries(Te))this.dvtag[i]=d;for(let i of t)this.createModule(i);for(let i of this.modules.values())this.applyModuleDecoration(i);for(let i of this.modules.values())this.applyErrorDecoration(i);for(let i of this.modules.values())this.applyPluginDecoration(i);for(let i of this.modules.values())this.applyApiDecoration(i);for(let i of this.modules.values())this.applyExecuteDecoration(i)}get moduleList(){return[...this.modules.keys()].map(t=>t.name)}get entryModuleList(){return[...this.modules.entries()].filter(([t,e])=>e instanceof x).map(([t,e])=>t.name)}get(t){return this.getModule(t).gateway}getByName(t){let e=[...this.modules.keys()].find(r=>r.name===t);return e!=null?this.get(e):null}getModule(t){let e=this.modules.get(t);if(e==null)throw new Error(`module not in core: ${t.name}`);return e}createModule(t){if(t.prototype.moduleConfig==null)throw new Error(`not a module: ${t.name}`);let e=new t;e.core=this,e.gateway={module:e},this.modules.set(t,e)}applyModuleDecoration(t){var i,d,u,m,f,h;let e=t.constructor.prototype.moduleConfig,r=t.constructor.name;for(let{method:S}of e){let I=t[S].bind(t),U=(u=(d=(i=this.dvtag._hooks)==null?void 0:i.interceptModule)==null?void 0:d[r])==null?void 0:u[S],w=U==null?I:U.bind(t),Z=(h=(f=(m=this.dvtag._hooks)==null?void 0:m.inspectModule)==null?void 0:f[r])==null?void 0:h[S],jt=Z==null?w:(...mt)=>{let pt=w(...mt);return Z(mt,pt),pt},fe=n((...mt)=>{let pt;try{pt=jt(...mt)}catch(ft){throw this.traceMethodError(t,S,mt,ft)}return pt instanceof Promise?pt.then(ft=>ft,ft=>{throw this.traceMethodError(t,S,mt,ft)}):pt},"traced");t.gateway[S]=fe}if(t.plugins!=null){t.pluginFunctions={};for(let S of Object.keys(t.plugins)){t.pluginFunctions[S]=[];let I=t.pluginFunctions[S];t.plugins[S]=(...U)=>{let w=[];for(let Z of I)try{w.push(Z(...U))}catch(jt){this.tracePluginError(t,S,jt)}return w}}}}traceMethodError(t,e,r,i){let d=new Ct(i);return d.addToTrace(`${t.constructor.name}.${e}(${r.map(u=>typeof u).join(",")})`),d}traceExecuteError(t){let e=new Ct(t);return e.addToTrace("@execute"),this.handleSevereError(e),e}tracePluginError(t,e,r){let i=new Ct(r);return i.addToTrace(`@plugin(${t.constructor.name}, '${e}')`),this.handleSevereError(i),i}traceApiError(t,e){let r=new Ct(e);return r.addToTrace(`@api('${t}')`),this.handleSevereError(r),r}handleSevereError(t){for(let e of this.errorHandlers)try{e(t)}catch(r){}this.errors.length>10||this.errors.push({message:t.message,trace:t.trace})}applyErrorDecoration(t){var r;let e=(r=t.constructor.prototype.errorConfig)!=null?r:[];for(let{method:i}of e)this.errorHandlers.push(t.gateway[i])}applyPluginDecoration(t){var r;let e=(r=t.constructor.prototype.pluginConfig)!=null?r:[];for(let{PluggableClass:i,category:d,method:u}of e)this.getModule(i).pluginFunctions[d].push(t.gateway[u])}applyApiDecoration(t){var r;let e=(r=t.constructor.prototype.apiConfig)!=null?r:[];for(let{api:i,method:d}of e)Object.defineProperty(this.dvtag,i,{value:(...u)=>{var m,f;try{return t.gateway[d](...u)}catch(h){return this.traceApiError(i,h),(f=(m=Te)[i])==null?void 0:f.call(m,...u)}},writable:!1})}applyExecuteDecoration(t){return A(this,null,function*(){var r;let e=(r=t.constructor.prototype.executeConfig)!=null?r:[];for(let{method:i}of e)try{yield t.gateway[i]()}catch(d){this.traceExecuteError(d)}})}};n(Re,"Core");var Gt=Re;var ye=[],Ee=ye;var c=n(o=>{let t=o.prototype,e=Object.getOwnPropertyNames(t).filter(r=>{var i;return r!=="constructor"&&((i=Object.getOwnPropertyDescriptor(t,r))==null?void 0:i.value)instanceof Function});t.moduleConfig=e.map(r=>({method:r})),ye.push(o)},"moduleClass"),q=n(o=>t=>{},"attachModule"),C=n((o,t)=>{var e;o.executeConfig=(e=o.executeConfig)!=null?e:[],o.executeConfig.push({method:t})},"executeMethod"),p=n((o,t)=>(e,r)=>{var i;e.pluginConfig=(i=e.pluginConfig)!=null?i:[],e.pluginConfig.push({PluggableClass:o,category:t,method:r})},"pluginMethod"),Ft=n(o=>(t,e)=>{var r;t.apiConfig=(r=t.apiConfig)!=null?r:[],t.apiConfig.push({api:o,method:e})},"apiMethod"),Ke=n((o,t)=>{var e;o.errorConfig=(e=o.errorConfig)!=null?e:[],o.errorConfig.push({method:t})},"errorMethod");var Dt=n(o=>{if(o==null)return[];let t=We(o);return t!=null?[t]:Array.isArray(o)?o.map(We).filter(e=>e!=null):[]},"parseSlotSizes"),We=n(o=>{if(o==null)return null;if(typeof o=="string")return{label:o};if(Array.isArray(o)){if(o.length===1&&typeof o[0]=="string")return{label:o[0]};if(o.length===2&&typeof o[0]=="number"&&typeof o[1]=="number")return{width:o[0],height:o[1]}}if(typeof o=="object"){let{label:t,width:e,height:r}=o;if(typeof e=="number"&&typeof r=="number")return{width:e,height:r};if(typeof t=="string")return{label:t}}return null},"parseSlotSize");var ze=n(o=>{try{return o.getSizes()}catch(t){return[]}},"getGptSlotSizesSafe");var Ht=n(o=>{let t=o.split("/").map(i=>i.trim()).filter(i=>i.length>0);if(t.length<2)return;let e=t[0].split(",",1)[0],r=Number(e);return Number.isNaN(r)?void 0:`${r}`},"getNetworkCodeFromAdUnit");var Xt=n((o,t)=>{let e=o.getAdUnitPath(),r=Ht(e);return{id:e,network:r,sizes:Dt(ze(o)),position:o.getTargeting(t)[0]}},"gptSlotToAdUnit");var Jt=n((o,t)=>({getTargeting:e=>[...new Set([...t(e),...o.getTargeting(e)])],setTargeting:(e,r)=>{o.setTargeting(e,r)}}),"gptSlotToTargetable");var _e="dvp_spos";var F=class{_getAdServers(){try{return a}catch(t){return{}}}isAdServerConfigured(t){return t!=null&&t in this._getAdServers()}getAdServerConfig(t){var e;return this.isAdServerConfigured(t)?(e=this._getAdServers()[t])!=null?e:{}:{}}getAdServerCustomTracking(t){var e;return this.isAdServerConfigured(t)?(e=this._getAdServers()[t].customTracking)!=null?e:{}:{}}getAdServerId(t){return this.isAdServerConfigured(t)?this._getAdServers()[t].adServerId:null}getAdPositionKey(t){var e,r;return t==null?_e:(r=(e=this._getAdServers()[t])==null?void 0:e.adPositionKey)!=null?r:_e}};n(F,"AdServers"),F=s([c],F);var Zt,ro=new Uint8Array(16);function be(){if(!Zt&&(Zt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Zt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Zt(ro)}n(be,"rng");var N=[];for(let o=0;o<256;++o)N.push((o+256).toString(16).slice(1));function Ye(o,t=0){return N[o[t+0]]+N[o[t+1]]+N[o[t+2]]+N[o[t+3]]+"-"+N[o[t+4]]+N[o[t+5]]+"-"+N[o[t+6]]+N[o[t+7]]+"-"+N[o[t+8]]+N[o[t+9]]+"-"+N[o[t+10]]+N[o[t+11]]+N[o[t+12]]+N[o[t+13]]+N[o[t+14]]+N[o[t+15]]}n(Ye,"unsafeStringify");var oo=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ve={randomUUID:oo};function no(o,t,e){if(ve.randomUUID&&!t&&!o)return ve.randomUUID();o=o||{};let r=o.random||(o.rng||be)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){e=e||0;for(let i=0;i<16;++i)t[e+i]=r[i];return t}return Ye(r)}n(no,"v4");var Ce=no;var ht=n(()=>Ce(),"uuid");var Ie=class Ie{constructor(t,e,r,i,d){this._slotStore=t;this.source=e;this.elementId=r;this.adUnit=i;this._targetable=d;g(this,"uuid");g(this,"_variables",new Map);g(this,"_targeting",{});g(this,"_flushedTargeting",{});this.uuid=ht()}setVariable(t,e){this._variables.set(t,e)}getVariable(t){return this._variables.get(t)}clearVariable(t){this._variables.delete(t)}getUptTargetingKeys(){return[...new Set([...Object.keys(this._targeting),...this._slotStore.getUptPageTargetingKeys()])]}getUptTargetingForKey(t){var e;return[...new Set([...(e=this._targeting[t])!=null?e:[],...this._slotStore.getUptPageTargetingForKey(t)])]}getUptTargeting(){let t={};for(let e of this.getUptTargetingKeys())t[e]=this.getUptTargetingForKey(e);return t}setUptSlotTargeting(t){for(let[e,r]of Object.entries(t))this._targeting[e]=[...new Set(r)],this.flushUptTargetingToAdServer(e)}addUptSlotTargeting(t){var e;for(let[r,i]of Object.entries(t))this._targeting[r]=[...new Set([...(e=this._targeting[r])!=null?e:[],...i])],this.flushUptTargetingToAdServer(r)}getAdServerTargeting(t){var e,r;return(r=(e=this._targetable)==null?void 0:e.getTargeting(t))!=null?r:[]}flushUptTargetingToAdServer(t){var i;if(this._targetable==null)return;let e=(i=this._flushedTargeting[t])!=null?i:[],r=this.getUptTargetingForKey(t);(e.length!==r.length||r.sort().some((d,u)=>e[u]!==d))&&(this._targetable.setTargeting(t,this.getUptTargetingForKey(t)),this._flushedTargeting[t]=r)}forceFlushAllUptTargetingToAdServer(){this._targetable!=null&&(this._flushedTargeting={},this.getUptTargetingKeys().forEach(t=>this.flushUptTargetingToAdServer(t)))}validateAdServerTargeting(){let t=2;for(let e of this.getUptTargetingKeys()){let r=this.getUptTargetingForKey(e),i=this.getAdServerTargeting(e);if(r.length>i.length||r.some(d=>!i.includes(d)))return 0;i.length>r.length&&(t=1)}return t}};n(Ie,"Slot");var Vt=Ie;var T=class{constructor(){g(this,"plugins",{slotDiscovered:(t,e)=>[],slotDestroyed:t=>[]});g(this,"_slots",{});g(this,"_pageTargeting",{})}getSlot(t,e){var r;return(r=this._slots[t])==null?void 0:r[e]}getSlots(t){var e;if(t==null){let r=[];for(let i of Object.values(this._slots))r.push(...Object.values(i));return r}return Object.values((e=this._slots[t])!=null?e:{})}createSlot(t,e,r,i,d,u){var h,S;let m=this.getSlot(t,r);m!=null&&this.plugins.slotDestroyed(m);let f=new Vt(this,t,r,i,d);(S=(h=this._slots)[t])!=null||(h[t]={}),this._slots[t][r]=f;for(let I of Object.keys(this._pageTargeting))f.flushUptTargetingToAdServer(I);return u==null||u(f),this.plugins.slotDiscovered(f,e),f}getUptPageTargetingKeys(){return Object.keys(this._pageTargeting)}getUptPageTargetingForKey(t){var e;return(e=this._pageTargeting[t])!=null?e:[]}getUptPageTargeting(){let t={};for(let[e,r]of Object.entries(this._pageTargeting))t[e]=[...r];return t}setUptPageTargeting(t){for(let[e,r]of Object.entries(t))this._pageTargeting[e]=[...new Set(r)];this._flushUptPageTargetingToAdServer(Object.keys(t))}addUptPageTargeting(t){var e;for(let[r,i]of Object.entries(t))this._pageTargeting[r]=[...new Set([...(e=this._pageTargeting[r])!=null?e:[],...i])];this._flushUptPageTargetingToAdServer(Object.keys(t))}_flushUptPageTargetingToAdServer(t){for(let e of Object.values(this._slots))for(let r of Object.values(e))for(let i of t)r==null||r.flushUptTargetingToAdServer(i)}};n(T,"SlotStore"),T=s([c],T);var xe=class xe{constructor(){g(this,"pending",[]);g(this,"flushing",!1)}push(t){this.pending.push(t),this.flush()}flush(){return A(this,null,function*(){var e;if(this.flushing)return;this.flushing=!0;let t=this.pending.shift();for(;t!=null;){try{yield t.promise}catch(r){}try{(e=t.callback)==null||e.call(t)}catch(r){}t=this.pending.shift()}this.flushing=!1})}};n(xe,"AsyncQueue");var te=xe;var y=class{constructor(){g(this,"plugins",{adRequestQueued:t=>[],adRequestTimedOut:t=>[],adRequestBeforeRelease:t=>[],adRequestCompleted:t=>[]});g(this,"queue",new te);g(this,"adRequestCounter",0)}_queueAdRequest(t={}){var d,u;let e={index:this.adRequestCounter++,status:"queued",timeoutValue:(d=t.timeout)!=null?d:0,onDvtagReadyCalled:(u=t.timestamp)!=null?u:0,waitingStarted:new Date().getTime(),internal:t.internal};this.plugins.adRequestQueued(e);let r=t.callback;r===void 0?t.callback=()=>{}:r===null?e.status="tag-timeout":t.callback=()=>{e.status="queue-timeout",e.callbackCalled=new Date().getTime(),t.callback=null,this.plugins.adRequestTimedOut(e);try{r()}catch(m){}};let i=n(()=>{if(t.callback!=null){t.callback=null,e.status="success",e.callbackCalled=new Date().getTime(),this.plugins.adRequestBeforeRelease(e);try{r==null||r()}catch(m){}}else this.plugins.adRequestBeforeRelease(e);e.waitingEnded=new Date().getTime(),this.plugins.adRequestCompleted(e)},"onAsyncOperationsCompleted");this.queue.push({callback:i,adRequest:e})}delayAdRequests(t){this.queue.push({promise:t})}};n(y,"AdRequestQueue"),s([Ft("queueAdRequest")],y.prototype,"_queueAdRequest",1),y=s([c],y);var so=[[/((\?)|&)(?:amp_lite|fr=operanews)/g,"$2"],[/(^https?:\/\/)(www\.)/g,"$1"],[/(((\?)|&|%3F|%26|;)(?:utm_campaign|utm_source|utm_content|utm_term|utm_viral|utm_medium|utm_identifier|utm_key|fb_source|referrer|referer|ref|rand|rnd|randid|\.?rand|\.?partner|cb|count|adid|session|sessionid|session_redirect|param\d|userinfo|uid|refresh|ocid|ncid|clickenc|fbclid|amp_js_v|amp_gsa|ns_source|ns_campaign|ns_mchanel|ns_mchannel|ns_linkname|ns_fee|src|ex_cid|usqp|source|xid|trkid|utm_social-type|mbid|utm_brand|__twitter_impression|utm_referrer|CMP|cmp|_cmp|cq_cmp)=[^&]*)/g,"$3"],[/[/.]amp(?:\/[?&]*)?$/g,""],[/((\?)|&)(?:outputType|isFollow|suppressMediaBar|cid|ICID|icid|bdk|wtu_id_h|utm_placement|intcmp|_native_ads|traffic_source|entry|\.tsrc|autoplay|autostart|dc_data|influencer|pubdate|utm_hp_ref|redirect|service|refresh_ce|refresh_cens|xcmg|target_id|_amp)=[^&]*/g,"$2"],[/(\?|&)(?:amp)(?:&|$|=[^&]*)/g,"$1"]],ao=[[/(?:\/|\/\?|\?|&|\/\$0|#[\s\S]*)+$/g,""],[/(?:\/|\/\?|\?|&|\/\$0|#[\s\S]*)+$/g,""]],He=n((o,t)=>{for(let[e,r]of o)t=t.replace(e,r);return t},"replaceByRules"),Xe=n(o=>{let t=He(so,o);return He(ao,t)},"normalizeUrl");var Je=n(o=>o.split("?",1)[0].split("#",1)[0],"stripUrlQuery");var Ze=n((o,t)=>{try{let e=new URLSearchParams(o),r=e.get("ctx"),i=e.get("cmp");if(r!=null&&i!=null)return{ctx:r,cmp:i,prefetch:t,legacy:!0}}catch(e){}return null},"parseInfo"),tr=n(o=>{var t;return o.pathname!=="/signals/pub.js"?null:(t=Ze(o.search,!0))!=null?t:Ze(o.hash.substring(1),!1)},"parseLegacyPagetagUrl");var lo=/^\/dvtag\/([^/]+)\/([^/]+)\/pub\.js$/,b=class{constructor(){g(this,"visitUuid",ht());g(this,"tagInfo");g(this,"normalizedUrl")}_initialize(){this.getTagInfo()}getTagInfo(){var t;if(this.tagInfo==null){try{this.tagInfo=this._parseTagInfo()}catch(e){}(t=this.tagInfo)!=null||(this.tagInfo={ctx:"unknown",cmp:"unknown"})}return this.tagInfo}getVisitUuid(){return this.visitUuid}_parseTagInfo(){let t=this.getCurrentScriptSrc();if(t==null)return null;let e=new URL(t,"https://pub.doubleverify.com"),r=e.pathname,i=lo.exec(r);if(i!=null){let[,d,u]=i;return{ctx:d,cmp:u}}return tr(e)}getCurrentScriptSrc(){var t,e;return(e=(t=this.core.window.document.currentScript)==null?void 0:t.getAttribute("src"))!=null?e:null}getStrippedPageUrl(){return Je(this.core.window.location.href)}getNormalizedPageUrl(){var e;let t=this.getStrippedPageUrl();return((e=this.normalizedUrl)==null?void 0:e.stripped)!==t&&(this.normalizedUrl={stripped:t,normalized:Xe(this.core.window.location.href)}),this.normalizedUrl.normalized}};n(b,"Context"),s([C],b.prototype,"_initialize",1),b=s([c],b);var Q=class{getShortCommitId(){return"c17ea96"}getBuildTimestamp(){return 1729828957263}getAuthToken(){return"4ghddd4pmipYbE4k3yY4GDvsdxHCEaPRfEO/zXEcJ3kWE35B1XzbhSXgfVvwVMH9DhwK71ILr69Yl9OV9HhZN+r15PgDVQ4Ib3XUelIysgkcG1jo81jWZIBDsVNf5qI+eGx9Rg1vpTTUNZ2IjUJM9uzGH3/DzQ=="}};n(Q,"DefinedVariables"),Q=s([c],Q);var $=class{constructor(){g(this,"cache",{})}_performFetchJson(t,e){return A(this,null,function*(){let r=t;if(e!=null&&e.authToken){let u=this.core.get(Q).getAuthToken(),m=new URL(t);m.searchParams.set("token",u),r=m.href}let i=yield this.core.window.fetch(r);return{json:yield i.json(),headers:i.headers}})}fetchJson(t,e){return A(this,null,function*(){let r=this.cache[t];return r==null&&(r=this._performFetchJson(t,e).then(i=>i.json),this.cache[t]=r),r})}};n($,"Fetch"),$=s([c],$);var Qt=["BSC","ABS","CCT"],Pe=["IDS"],Bt=["VLP","TVP"],go=[...Qt,...Pe,...Bt],Ds=[...Qt,...Pe,...Bt].filter(o=>o!=="CCT"),er=n(o=>go.includes(o.toUpperCase()),"isSignal"),rr=n(o=>Bt.includes(o.toUpperCase()),"isSlotSignal"),or=n(o=>Pe.includes(o.toUpperCase()),"isUserSignal"),nr=n(o=>Qt.includes(o.toUpperCase()),"isPageSignal");var ee=n(o=>o==null?"":`@${o}`,"getPositionSuffix");var co=/^(\d+)x(\d+)$/,ir=n(o=>o==="all"?[]:o.split(",").map(t=>{let e=t.match(co);return e==null?{label:t}:{width:parseInt(e[1],10),height:parseInt(e[2],10)}}),"stringToSlotSizes"),we=n(o=>o.length===0?"all":o.map(({width:t,height:e,label:r})=>r!=null?r:`${t}x${e}`).join(","),"slotSizesToString"),sr=n(o=>o==null?"":o.length>0&&o.every(({label:r})=>r==null)?we(o):"","slotSizesToStringIfSpecific");var uo="https://pub.doubleverify.com/dvtag/signals/",K=class{_getBaseUrl(t){let e=this.core.get(b),{ctx:r,cmp:i}=e.getTagInfo(),d=e.getNormalizedPageUrl();try{d=new URL(d).origin}catch(m){}let u=new URL(t,uo);return u.searchParams.set("ctx",r),u.searchParams.set("cmp",i),u.searchParams.set("url",d),u}getUserTargetingUrl(t){let e=this._getBaseUrl("ids/pub.json");return t.includes("IDS")&&e.searchParams.set("ids","1"),e.href}getPageTargetingUrl(t,e){let r=this._getBaseUrl("bsc/pub.json");return r.searchParams.set("url",e),t.includes("BSC")&&r.searchParams.set("bsc","1"),t.includes("ABS")&&r.searchParams.set("abs","1"),t.includes("CCT")&&r.searchParams.set("cct","1"),r.href}getSlotTargetingUrl(t,e){var d;let r=this._getBaseUrl("vlp/pub.json");t.includes("VLP")&&r.searchParams.set("vlp","1"),t.includes("TVP")&&r.searchParams.set("tvp","1");let i=0;for(let u of e){let{id:m,position:f,sizes:h}=(d=u.adUnit)!=null?d:{},S=m+ee(f);r.searchParams.set(`slot-${i++}-${S}`,sr(h))}return r.href}};n(K,"SignalsUrlBuilder"),K=s([c],K);var St=class{constructor(){g(this,"cache",{})}_fetchFreshSignals(t,e){return A(this,null,function*(){if(!e.some(nr))return{};let r=this.core.get(K).getPageTargetingUrl(e,t),i;try{i=yield this.core.get($).fetchJson(r,{authToken:!0})}catch(d){return{}}return i instanceof Object?i:{}})}fetchSignals(t,e=3){return A(this,null,function*(){let r=this.core.get(b),i=r.getNormalizedPageUrl(),d=r.getStrippedPageUrl();this.cache[d]==null&&(this.cache[d]=this._fetchFreshSignals(i,t));let u=yield this.cache[d];return this.core.get(b).getStrippedPageUrl()!==d&&e>0?this.fetchSignals(t,e-1):u})}};n(St,"PageSignals"),St=s([c],St);var Tt=class{constructor(){g(this,"cache",{});g(this,"pendingSlots",[]);g(this,"pendingBulkRequest",null)}_scheduleBulkRequest(t){return A(this,null,function*(){yield Promise.resolve();let e=this.core.get(K).getSlotTargetingUrl(t,this.pendingSlots);this.pendingSlots=[],this.pendingBulkRequest=null;let r;try{r=yield this.core.get($).fetchJson(e,{authToken:!0})}catch(i){return[]}return r})}_fetchFreshSignals(t,e){return A(this,null,function*(){if(!e.some(rr))return{};let r=this.pendingSlots.push(t)-1;this.pendingBulkRequest==null&&(this.pendingBulkRequest=this._scheduleBulkRequest(e));let d=(yield this.pendingBulkRequest)[r];return d instanceof Object?d:{}})}_getCacheKey(t){var m,f;let{id:e,position:r,sizes:i}=(m=t.adUnit)!=null?m:{},d=e+ee(r),u=(f=i==null?void 0:i.map(h=>{var S;return(S=h.label)!=null?S:`${h.width}x${h.height}`}).sort().join(","))!=null?f:"";return`${d}#${u}`}fetchSignals(t,e){return A(this,null,function*(){let r=this._getCacheKey(t);return this.cache[r]==null&&(this.cache[r]=this._fetchFreshSignals(t,e)),this.cache[r]})}};n(Tt,"SlotSignals"),Tt=s([c],Tt);var At=class{constructor(){g(this,"cache")}_fetchFreshSignals(t){return A(this,null,function*(){if(!t.some(or))return{};let e=this.core.get(K).getUserTargetingUrl(t),r;try{r=yield this.core.get($).fetchJson(e,{authToken:!0})}catch(i){return{}}return r instanceof Object?r:{}})}fetchSignals(t){return A(this,null,function*(){return this.cache==null&&(this.cache=this._fetchFreshSignals(t)),this.cache})}};n(At,"UserSignals"),At=s([c],At);var R=class{constructor(){g(this,"plugins",{getEnabledSignals:()=>[],userTargetingUpdated:t=>[],pageTargetingUpdated:t=>[],slotTargetingUpdated:(t,e)=>[]});g(this,"dataForMigrationTracking",{userTargeting:{},pageTargeting:{},slotTargeting:new Map})}getEnabledSignals(){return this.plugins.getEnabledSignals()}getDataForMigrationTracking(){return this.dataForMigrationTracking}_initialize(){this.getUserTargeting(),this.getPageTargeting()}_onAdRequestQueued(){this.getPageTargeting()}_onSlotDiscovered(t){this.getSlotTargeting(t)}getUserTargeting(){return A(this,null,function*(){let t=this._fetchUserTargeting();return this.core.get(y).delayAdRequests(t),t})}getPageTargeting(){return A(this,null,function*(){let t=this._fetchPageTargeting();return this.core.get(y).delayAdRequests(t),t})}getSlotTargeting(t){return A(this,null,function*(){let e=this._fetchSlotTargeting(t);return this.core.get(y).delayAdRequests(e),e})}_fetchUserTargeting(){return A(this,null,function*(){let t=this.core.get(T),e=yield this.core.get(At).fetchSignals(this.getEnabledSignals());return t.setUptPageTargeting(e),this.dataForMigrationTracking.userTargeting=e,this.plugins.userTargetingUpdated(e),e})}_fetchPageTargeting(){return A(this,null,function*(){let t=this.core.get(T),e=yield this.core.get(St).fetchSignals(this.getEnabledSignals());return t.setUptPageTargeting(e),this.dataForMigrationTracking.pageTargeting=e,this.plugins.pageTargetingUpdated(e),e})}_fetchSlotTargeting(t){return A(this,null,function*(){let e=yield this.core.get(Tt).fetchSignals(t,this.getEnabledSignals());return t.setUptSlotTargeting(e),this.dataForMigrationTracking.slotTargeting.set(t,e),this.plugins.slotTargetingUpdated(t,e),e})}};n(R,"Signals"),s([C],R.prototype,"_initialize",1),s([p(y,"adRequestQueued")],R.prototype,"_onAdRequestQueued",1),s([p(T,"slotDiscovered")],R.prototype,"_onSlotDiscovered",1),R=s([c],R);var W=class{constructor(){g(this,"pq",null)}getPq(){return this.pq==null&&(this.pq=this._initialize()),this.pq}getPts(){return this.getPq().PTS}setApi(t){let e=this.getPq();e!=null&&(e.init=()=>{},e.loadSignals=t.loadSignals,e.loadSignalsForSlots=t.loadSignalsForSlots,e.getTargeting=t.getTargeting)}_pushToDvtagCmd(...t){var e;this.core.dvtag.cmd=(e=this.core.dvtag.cmd)!=null?e:[],this.core.dvtag.cmd.push(...t)}_initialize(){var r,i;this.core.window.PQ=(r=this.core.window.PQ)!=null?r:{};let t=this.core.window.PQ;if(t.loaded)return{cmd:[],PTS:{}};t.loaded=!0,t.PTS=(i=t.PTS)!=null?i:{};let e=t.cmd;return t.cmd={push:d=>this._pushToDvtagCmd(d)},Array.isArray(e)&&this._pushToDvtagCmd(...e),t}};n(W,"LegacyPq"),W=s([c],W);var ar=n(o=>{var r,i,d;let t=ht(),e={id:(i=(r=o.adUnitPath)!=null?r:o.invCode)!=null?i:o.tagId,sizes:Dt(ir((d=o.sizes)!=null?d:"all")),position:o.position};return{elementId:t,adUnit:e}},"parseLegacyAdUnit");var lr=n((o,t)=>{var i;let e=(i=o.IDS)==null?void 0:i[0];if(e==null)return;let r=parseInt(e);isNaN(r)||(t.IDS=r)},"setUserTargetingOnPts"),dr=n((o,t)=>{for(let e of Qt)o[e]!=null&&(t[e]=o[e])},"setPageTargetingOnPts"),gr=n((o,t,e)=>{var m,f,h,S,I,U;let{adUnit:r}=o;if((r==null?void 0:r.id)==null)return;let i=r.id,d=we((m=r.sizes)!=null?m:[]),u=r.position;for(let w of Bt){let Z=t[w];Z!=null&&((f=e[w])!=null||(e[w]={}),(S=(h=e[w])[i])!=null||(h[i]={}),e[w][i][d]=Z[0],u!=null&&((U=(I=e[w][i])[u])!=null||(I[u]={}),e[w][i][u][d]=Z[0]))}},"setSlotTargetingOnPts");var mo="legacy-api",cr="gpt",tt=class extends x{_initialize(){this.core.get(W).setApi({loadSignals:this.loadSignals.bind(this),loadSignalsForSlots:this.loadSignalsForSlots.bind(this),getTargeting:this.getTargeting.bind(this)})}_setUserTargetingOnPts(t){let e=this.core.get(W).getPts();lr(t,e)}_setPageTargetingOnPts(t){let e=this.core.get(W).getPts();dr(t,e)}_setSlotTargetingOnPts(t,e){let r=this.core.get(W).getPts();gr(t,e,r)}loadSignals(t,e){return A(this,null,function*(){yield this._onDvtagReady("loadSignals",e)})}loadSignalsForSlots(t,e,r){return A(this,null,function*(){let i=this.core.get(R),d=this.core.get(T);for(let m of t){let f=m.getSlotElementId(),h=d.getSlot(cr,f);if(h==null){let S=this.core.get(F).getAdPositionKey(m.getAdUnitPath());h=d.createSlot(cr,0,f,Xt(m,S),Jt(m,I=>this._getPubAdsTargeting(I)))}i.getSlotTargeting(h)}let u=typeof e=="function"?e:r;yield this._onDvtagReady("loadSignalsForSlots",u)})}getTargeting(t,e){return A(this,null,function*(){var u;let r=this.core.get(R),i=this.core.get(T);for(let m of(u=t.adUnits)!=null?u:[]){let{elementId:f,adUnit:h}=ar(m),S=i.createSlot(mo,0,f,h);r.getSlotTargeting(S)}let d=n(()=>e==null?void 0:e(void 0,this.core.get(W).getPts()),"callback");yield this._onDvtagReady("getTargeting",d)})}_getPubAdsTargeting(t){var e,r,i;return(i=(r=(e=this.core.window.googletag)==null?void 0:e.pubads)==null?void 0:r.call(e).getTargeting(t))!=null?i:[]}_onDvtagReady(t,e){return A(this,null,function*(){yield new Promise(r=>{this.core.window.dvtag.queueAdRequest({callback:()=>{try{e==null||e()}catch(i){}r()},timestamp:new Date().getTime(),timeout:750,internal:!0})})})}};n(tt,"LegacyLayer"),s([C],tt.prototype,"_initialize",1),s([p(R,"userTargetingUpdated")],tt.prototype,"_setUserTargetingOnPts",1),s([p(R,"pageTargetingUpdated")],tt.prototype,"_setPageTargetingOnPts",1),s([p(R,"slotTargetingUpdated")],tt.prototype,"_setSlotTargetingOnPts",1),tt=s([c],tt);var It=class extends x{_getEnabledSignals(){return"IDS"}};n(It,"SignalsIds"),s([p(R,"getEnabledSignals")],It.prototype,"_getEnabledSignals",1),It=s([c],It);var xt=class extends x{_getEnabledSignals(){return"BSC"}};n(xt,"SignalsBsc"),s([p(R,"getEnabledSignals")],xt.prototype,"_getEnabledSignals",1),xt=s([c],xt);var Pt=class extends x{_getEnabledSignals(){return"VLP"}};n(Pt,"SignalsVlp"),s([p(R,"getEnabledSignals")],Pt.prototype,"_getEnabledSignals",1),Pt=s([c],Pt);var wt=class extends x{_getEnabledSignals(){return"TVP"}};n(wt,"SignalsTvp"),s([p(R,"getEnabledSignals")],wt.prototype,"_getEnabledSignals",1),wt=s([c],wt);var Ot=class extends x{_getEnabledSignals(){return"ABS"}};n(Ot,"SignalsAbs"),s([p(R,"getEnabledSignals")],Ot.prototype,"_getEnabledSignals",1),Ot=s([c],Ot);var Oe=class Oe{set(t,e){t.setVariable(this,e)}get(t){return t.getVariable(this)}delete(t){t.clearVariable(this)}};n(Oe,"SlotVariable");var P=Oe;var v=class{constructor(){g(this,"adEmpty",new P);g(this,"plugins",{adRequested:t=>[],adRendered:(t,e)=>[],adRemoved:t=>[]})}setAdRequested(t){this.plugins.adRequested(t)}setAdRendered(t,e){this.setAdRemoved(t),this.adEmpty.set(t,!1),this.plugins.adRendered(t,e)}setAdRemoved(t){this.adEmpty.get(t)===!1&&(this.adEmpty.set(t,!0),this.plugins.adRemoved(t))}};n(v,"AdServerHub"),v=s([c],v);var D=class{getWindow(){return this.core.window}getDocument(){return this.getWindow().document}getUserAgent(){var t,e;return(e=(t=this.getWindow().navigator)==null?void 0:t.userAgent)!=null?e:""}getPageUrl(){var t,e;return(e=(t=this.getWindow().location)==null?void 0:t.href)!=null?e:""}getHostname(){return new URL(this.getPageUrl()).hostname}getNavigator(){return this.getWindow().navigator}getPerformance(){var t;return(t=this.getWindow().performance)!=null?t:{}}getPerformanceTimeMs(){var t,e,r;return Math.floor((r=(e=(t=this.getPerformance()).now)==null?void 0:e.call(t))!=null?r:null)}isInQuirksMode(){return this.getDocument().compatMode==="BackCompat"}};n(D,"Environment"),D=s([c],D);var M=class{constructor(){g(this,"plugins",{getAdContainer:t=>[]});g(this,"locatedAdContainer",new P)}getAdContainer(t){let e=this.locatedAdContainer.get(t);return e==null&&(e=this._locateAdContainer(t),this.locatedAdContainer.set(t,e)),e}_locateAdContainer(t){var e;return(e=this.plugins.getAdContainer(t).find(r=>r!=null))!=null?e:{element:this.core.window.document.getElementById(t.elementId)}}_forgetLocatedAdContainer(t){this.locatedAdContainer.delete(t)}};n(M,"AdLocator"),s([p(v,"adRemoved")],M.prototype,"_forgetLocatedAdContainer",1),M=s([c],M);var oe=n((o,t)=>{var i,d,u,m;let e=o;e.googletag=(i=e.googletag)!=null?i:{},e.googletag.cmd=(d=e.googletag.cmd)!=null?d:[];let r=(m=(u=e.googletag).pubads)==null?void 0:m.call(u);r!=null?t(r):e.googletag.cmd.push(()=>{t(e.googletag.pubads())})},"onPubAdsReady");var L=class{constructor(){g(this,"gptReference",new P);g(this,"plugins",{slotDiscovered:(t,e)=>[],slotDestroyed:t=>[]})}_scanForSlots(){oe(this.core.window,t=>{t.getSlots().map(e=>this.maybeDiscoverSlot(e,0))})}maybeDiscoverSlot(t,e){let r=this.core.get(T).getSlot("gpt",t.getSlotElementId());return r==null||this.gptReference.get(r)!==t?this._createSlot(t,e):r}_createSlot(t,e){let r=t.getSlotElementId(),i=t.getAdUnitPath(),d=Ht(i),u=this.core.get(F).getAdPositionKey(d),m=Xt(t,u),f=Jt(t,S=>{var I,U,w;return(w=(U=(I=this.core.window.googletag)==null?void 0:I.pubads)==null?void 0:U.call(I).getTargeting(S))!=null?w:[]});return this.core.get(T).createSlot("gpt",e,r,m,f,S=>this.gptReference.set(S,t))}_onSlotDiscovered(t,e){t.source==="gpt"&&this.plugins.slotDiscovered(t,e)}_onSlotDestroyed(t){t.source==="gpt"&&this.plugins.slotDestroyed(t)}};n(L,"GoogletagSlots"),s([C,p(y,"adRequestQueued")],L.prototype,"_scanForSlots",1),s([p(T,"slotDiscovered")],L.prototype,"_onSlotDiscovered",1),s([p(T,"slotDestroyed")],L.prototype,"_onSlotDestroyed",1),L=s([c],L);var et=class{constructor(){g(this,"plugins",{adRemoved:t=>[]})}_monitorAdRemoval(t){if(t.source!=="gpt")return;let e=this.core.get(D).getDocument().getElementById(t.elementId);if(e==null)return;new MutationObserver(i=>{let d=i.length,u=[...i].reverse(),m=0,f=e.children.length;for(let h of u){if(f===0){this.plugins.adRemoved(t);break}if(m===d-1)break;let S=h.removedNodes.length-h.addedNodes.length;f+=S,m++}}).observe(e,{childList:!0})}_onSlotDestroyed(t){this.plugins.adRemoved(t)}};n(et,"GoogletagAdRemoved"),s([p(L,"slotDiscovered")],et.prototype,"_monitorAdRemoval",1),s([p(L,"slotDestroyed")],et.prototype,"_onSlotDestroyed",1),et=s([c],et);var ie=n(o=>{if(typeof o=="string"||Array.isArray(o)&&o.length===2&&o.every(t=>typeof t=="number"))return o},"cleanSizeInput");var B=n(o=>{if(typeof o=="string")return o;if(typeof o=="number")return`${o}`},"cleanStringInput");var rt=class{constructor(){g(this,"plugins",{adRequested:t=>[],adRendered:(t,e)=>[]})}_initialize(){oe(this.core.window,t=>{t.addEventListener("slotRequested",e=>{let r=this.core.get(L).maybeDiscoverSlot(e.slot,1);this.plugins.adRequested(r)}),t.addEventListener("slotRenderEnded",e=>{let r=this.core.get(L).maybeDiscoverSlot(e.slot,2);if(e.isEmpty){this.plugins.adRendered(r,null);return}let i={advertiserId:B(e.advertiserId),campaignId:B(e.campaignId),creativeId:B(e.creativeId),lineItemId:B(e.lineItemId),renderedSize:ie(e.size)};this.plugins.adRendered(r,i)})})}};n(rt,"GoogletagEvents"),s([C],rt.prototype,"_initialize",1),rt=s([c],rt);var ur=n((o,t=!0)=>{let e=document.createElement("script");return e.setAttribute("src",o),t&&e.setAttribute("async",""),e},"createScriptElement");var se=n((o,t)=>{o.appendChild(t)},"addElement"),mr=n(o=>o==null?void 0:o.remove(),"removeElement");var $t=n((o,t,e)=>{e!=null&&o.setAttribute(t,e)},"setAttributeIfDefined");var pr=n((o,t)=>{let e=`<html><head></head><body>${t.outerHTML}</body></html>`;if(typeof o.srcdoc=="string")o.srcdoc=e;else{let r=Kt(o);if(r!=null)r.open(),r.write(e),r.close();else throw new Error("Could not write to iframe because it has no document")}},"setIframeContent"),fr=n((o={})=>{let t=document.createElement("iframe");if(t.style.display="none",$t(t,"name",o.name),$t(t,"src",o.src),$t(t,"id",o.id),$t(t,"class",o.elementClass),o.data!=null&&Object.assign(t.dataset,o.data),o.sandbox!=null&&o.sandbox!==!1){let e=o.sandbox===!0?"":o.sandbox;t.setAttribute("sandbox",e)}return t},"createIframe"),Kt=n(o=>{try{return o&&(o.contentDocument||o.contentWindow&&o.contentWindow.document||frames&&frames[o.name]&&frames[o.name].document)}catch(t){return null}},"getIframeDocument"),hr=n(o=>{var t,e;return(e=(t=Kt(o))==null?void 0:t.body)!=null?e:null},"getIframeDocumentBody"),Lt=n((o,t)=>{try{if(Kt(o)===null)return!0;if(o.src===""||o.src==="about:blank")return!1;let e=new URL(o.src),r=new URL(t.location.href);return e.origin!==r.origin}catch(e){return!0}},"isCrossOriginIframe");var po="google_ads_iframe_",Sr=n(o=>{if(o==null)return null;let t=o.querySelectorAll(`iframe[id^="${po}"]`);return t.length===1?t[0]:null},"lookupGptIframe");var Tr=n((o,t)=>{var m;let e=o.document.getElementById(t);if(e==null)return{element:null};let r=Sr(e);if(r==null)return{element:e};if(Lt(r,o))return{element:r};let d=Kt(r),u=(m=d==null?void 0:d.body)!=null?m:null;return u==null?{element:r}:{element:u,parentIframe:r}},"getGptAdContainer");var j=class{_onAdRequested(t){this.core.get(v).setAdRequested(t)}_onAdRendered(t,e){this.core.get(v).setAdRendered(t,e)}_onAdRemoved(t){this.core.get(v).setAdRemoved(t)}_getAdContainer(t,e=Tr){return t.source!=="gpt"?null:e(this.core.get(D).getWindow(),t.elementId)}};n(j,"Googletag"),s([p(rt,"adRequested")],j.prototype,"_onAdRequested",1),s([p(rt,"adRendered")],j.prototype,"_onAdRendered",1),s([p(et,"adRemoved")],j.prototype,"_onAdRemoved",1),s([p(M,"getAdContainer")],j.prototype,"_getAdContainer",1),j=s([c],j);var E=class{constructor(){g(this,"plugins",{log:(...t)=>[],info:(...t)=>[],debug:(...t)=>[],warn:(...t)=>[],error:(...t)=>[]})}log(...t){this.plugins.log(...t)}info(...t){this.plugins.info(...t)}debug(...t){this.plugins.debug(...t)}warn(...t){this.plugins.warn(...t)}error(...t){this.plugins.error(...t)}};n(E,"Logging"),E=s([c],E);var Ar={GPT_MEASUREMENT:"on",CREATIVE_WRAPPER:"off",MEASUREMENT_INJECTION_TIMING:"onAdRendered (deprecated)",MEASUREMENT_INJECTION_STRATEGY:"preferPiggyback (deprecated)",F9_AD_LOCATORS_SEPARATE_TASKS:"on (deprecated)",AD_CONTAINER_LOCATION_STRATEGY:"preferGptIframeBody (deprecated)",FALCON_TEST:"off",FALCON_TEST_SCRIPT_FLAVOR:"cdn"},ae={variations:[{weight:99,featureFlags:{GPT_MEASUREMENT:"on",CREATIVE_WRAPPER:"off",FALCON_TEST:"on",FALCON_TEST_SCRIPT_FLAVOR:"cdn"}},{weight:1,featureFlags:{GPT_MEASUREMENT:"on",CREATIVE_WRAPPER:"off",FALCON_TEST:"on",FALCON_TEST_SCRIPT_FLAVOR:"falcon"}}],avoidPiggybackInjection:!1};var G=class{constructor(){g(this,"config");g(this,"plugins",{provideConfig:(t,e)=>[]})}_getConfiguration(){if(this.config!=null)return this.config;let{ctx:t,cmp:e}=this.core.get(b).getTagInfo(),r=this.plugins.provideConfig(t,e);if(r.length>1)throw new Error("Not allowed to use more than one config module in the build");if(r.length===1){let i=r[0],{variations:d}=i,u=$e(i,["variations"]),m=d==null;m&&this.core.get(E).warn("Publisher-specific config has no variations, using variation from default config"),this.config=vt(_(_({},ae),u),{variations:m?ae.variations:d})}else this.core.get(E).warn("No publisher-specific config included in build, using default config"),this.config=ae;return this.core.get(E).info("Configuration",this.config),this.config}getVariations(){return this._getConfiguration().variations}getAdFormats(){var t;return(t=this._getConfiguration().adFormats)!=null?t:[]}shouldAvoidPiggybackInjection(){return this._getConfiguration().avoidPiggybackInjection===!0}};n(G,"ConfigModule"),G=s([c],G);var Rr=["GPT_MEASUREMENT","CREATIVE_WRAPPER","MEASUREMENT_INJECTION_TIMING","MEASUREMENT_INJECTION_STRATEGY","F9_AD_LOCATORS_SEPARATE_TASKS","AD_CONTAINER_LOCATION_STRATEGY","FALCON_TEST","FALCON_TEST_SCRIPT_FLAVOR"],yr={GPT_MEASUREMENT:["off","on"],CREATIVE_WRAPPER:["off","on"],MEASUREMENT_INJECTION_TIMING:["onAdRendered (deprecated)","onAdLoaded (deprecated)"],MEASUREMENT_INJECTION_STRATEGY:["rootPage (deprecated)","preferPiggyback (deprecated)"],F9_AD_LOCATORS_SEPARATE_TASKS:["off (deprecated)","on (deprecated)"],AD_CONTAINER_LOCATION_STRATEGY:["preferGptIframe (deprecated)","preferGptDiv (deprecated)","preferGptIframeBody (deprecated)","preferCwSpan (deprecated)"],FALCON_TEST:["off","on"],FALCON_TEST_SCRIPT_FLAVOR:["cdn","falcon"]};var fo=n(o=>Math.random()*o,"scaledRandom"),Er=n(o=>{var m;let t=o.map(f=>f.item),e=o.map(f=>f.weight),r=e.reduce((f,h)=>{var U;let S=(U=f[f.length-1])!=null?U:0,I=h+S;return[...f,I]},[]),i=r[r.length-1],d=fo(i),u=(m=r.map((f,h)=>({cumWeight:f,index:h})).find(({cumWeight:f})=>d<f))==null?void 0:m.index;return u!=null?{selectedItem:t[u],weight:e[u],weightsSum:i}:null},"weightedRandom");var X=class{constructor(){g(this,"variationSelection");g(this,"plugins",{variationSelected:t=>[]})}_initialize(){this._selectVariationOnce()}_selectVariationOnce(){if(this.variationSelection!=null)return this.variationSelection;let t=this.core.get(G).getVariations(),e=Er(t.map(r=>({item:r,weight:r.weight})));if(e!=null){let{selectedItem:r,weight:i,weightsSum:d}=e;this.variationSelection={featureFlags:Object.assign({},Ar,r.featureFlags),fraction:{numerator:i,denominator:d}}}else throw new Error("No variation selected");return this.core.get(E).info("Selected variation",this.variationSelection),this.plugins.variationSelected(this.variationSelection),this.variationSelection}getFeatureFlags(){return this._selectVariationOnce().featureFlags}getVariationFraction(){return this._selectVariationOnce().fraction}};n(X,"VariationsModule"),s([C],X.prototype,"_initialize",1),X=s([c],X);var k=class{_getVariationFlags(){return this.core.get(X).getFeatureFlags()}get(t){return this._getVariationFlags()[t]}encodeAsHexString(t){return Rr.reduce((e,r)=>{let i=t[r];return yr[r].indexOf(i).toString(16)+e},"")}};n(k,"FeatureFlags"),k=s([c],k);var O=class{constructor(){g(this,"global",{});g(this,"local",new P)}getGlobalParams(){return this.global}getSlotParams(t){let e=this.local.get(t);return e==null&&(e={},this.local.set(t,e)),e}};n(O,"MeasurementUrlParams"),O=s([c],O);var at=class{_trackBuildData(){let t=this.core.get(O).getGlobalParams();t.dvp_uptbts=this.core.get(Q).getBuildTimestamp(),t.dvp_uptbcid=this.core.get(Q).getShortCommitId()}};n(at,"BuildTracking"),s([C],at.prototype,"_trackBuildData",1),at=s([c],at);var _r=n(o=>{let t={};for(let e in o)if(Object.prototype.hasOwnProperty.call(o,e)){let r=o[e];t[e]=r==null?[]:[o[e]]}return t},"objectValuesAsArray");var le=n((o,t)=>{let e=_r(t);o.setUptSlotTargeting(e)},"pushToWrapper");var de="dv__";var ot=class{constructor(){g(this,"deduplicationSet",new P);g(this,"deduplicationReliable",new P)}setDeduplicationTargeting(t){this.core.get(E).info(`Scheduling targeting for ${t.elementId}`);let e=this.core.get(k).get("CREATIVE_WRAPPER")==="on";this._setTargeting(t,e?1:0),this.deduplicationSet.set(t,!0)}_onAdRequested(t){this.deduplicationReliable.set(t,this.deduplicationSet.get(t)===!0)}_setTargeting(t,e){let r={dv_upt_cwm:e.toString()};this.core.get(E).info(`Setting slot targeting for ${t.elementId}`,r),le(t,r)}isDeduplicationReliable(t){return this.deduplicationReliable.get(t)===!0}};n(ot,"DuplicateMeasurement"),s([p(v,"adRequested")],ot.prototype,"_onAdRequested",1),ot=s([c],ot);var ge=n((o,t)=>Object.entries(t).reduce((r,[i,d])=>(r[`${o}${i}`]=d,r),{}),"prefixKeys");var z=class{constructor(){g(this,"impressionCount",new P);g(this,"topologies",new P)}_onNewSlotDetected(t){this._setupTargetingForNextAdLoad(t)}_adRenderedForSlot(t,e){e!=null&&(this._incrementSlotImpressionCount(t),this._setSlotParams(t),this._setupTargetingForNextAdLoad(t))}_setSlotParams(t){let e=this.core.get(O).getSlotParams(t),r=this.topologies.get(t);r!=null&&(e.dvp_uptpid=r.pageVisitId,e.dvp_uptsid=r.slotId,e.dvp_uptsacnt=r.slotAdCount)}_setupTargetingForNextAdLoad(t){let r={pageVisitId:this.core.get(b).getVisitUuid(),slotId:t.uuid,slotAdCount:`${this.getSlotImpressionCount(t)+1}`};this.topologies.set(t,r),le(t,ge(de,{dvp_uptpid:r.pageVisitId,dvp_uptsid:r.slotId,dvp_uptsacnt:r.slotAdCount}))}getSlotImpressionCount(t){var e;return(e=this.impressionCount.get(t))!=null?e:0}_incrementSlotImpressionCount(t){this.impressionCount.set(t,this.getSlotImpressionCount(t)+1)}};n(z,"ImpressionTopology"),s([p(T,"slotDiscovered")],z.prototype,"_onNewSlotDetected",1),s([p(v,"adRendered")],z.prototype,"_adRenderedForSlot",1),z=s([c],z);var br="gptm";var ho=n(o=>{var t;return(t=o.ownerDocument)!=null?t:o},"getDocument");var vr=n((o,t)=>ho(t).evaluate(o,t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),"getAllNodesByXpath"),Cr=n((o,t)=>vr(o,t).iterateNext()!=null,"hasXpathMatches"),So=n(o=>(o==null?void 0:o.nodeType)===Node.ELEMENT_NODE?o:null,"nodeToElement");var Ue=n((o,t)=>{let e=[],r=vr(o,t),i=r.iterateNext();for(;i!=null;){let d=So(i);d!=null&&e.push(d),i=r.iterateNext()}return e},"getAllElementsByXpath");var Ir=n((o,t)=>o.filter(e=>e.detect(t)),"detectAdFormats"),xr=n(o=>o.map(t=>t.id).reduce((t,e)=>t|e,0),"encodeAdFormats");var Pr=n((o,t)=>{let e=null,r=[],i=0;t!=null&&(r=Ir(o,t),r.length===1&&(e=r[0].target(t))),e==null&&(t==null&&(i|=1),r.length>1&&(i|=2),r.length===1&&(i|=4));let d={detectedAdFormats:r};return i>0&&(d.adTargetingErrorCode=i),{adTarget:e,diagnostics:d}},"getAdFormatsTargeting"),wr=n(({detectedAdFormats:o,adTargetingErrorCode:t})=>{let e={};return o.length>0&&(e.dvp_pubdaf=xr(o)),t!=null&&(e.dvp_pubate=t),e},"getAdFormatsTargetingDiagnosticsTracking");var Or=n((o,t,e="")=>{if(o.length<=t)return o;let r=t-e.length;return r<0?e:o.slice(0,r)+e},"truncate");var To="104",Rt=class{getAdServerTracking(t){let e={adsrv:To},{network:r}=t.adUnit;if(r==null)return e;let i=this.core.get(F).getAdServerId(r);return i==null?e:vt(_({},e),{dvp_gptmasid:i})}};n(Rt,"AdServerTracking"),Rt=s([c],Rt);var yt=class{resolve(t,e){let r={};return Object.entries(t).forEach(([i,d])=>{let u=e.getAdServerTargeting(d.key);r[i]=u.join(",")}),r}};n(yt,"TargetingCustomTracking"),yt=s([c],yt);var Et=class{trackCustomMetadata(t){let{network:e}=t.adUnit;if(e==null)return{};let r=this.core.get(F).getAdServerCustomTracking(e);return this.core.get(yt).resolve(r,t)}};n(Et,"CustomMetadataTracking"),Et=s([c],Et);var Ur=n(o=>({dvp_gptmcw:o?1:o==null?-1:0}),"getCwTracking");var Nr=["hb_pb","hb_adid","hb_bidder","hb_size","hb_format","hb_deal","hb_uuid","hb_cache_id","hb_cache_host","hb_cache_path","hb_source","hb_adomain","hb_env"],Ao=n(o=>Object.values(o).reduce((t,e)=>t+e.length,0)>0,"hasAtLeastOnePrebidTargetingConfigured"),Fr=n(o=>{let t={};for(let e of Nr)t[e]=o.getAdServerTargeting(e);return Ao(t)?{dvp_gptmhb:Nr.map(e=>t[e].map(r=>encodeURIComponent(r)).join(",")).join(";")}:{}},"getPrebidTracking");var Dr=n((o,t)=>{let{element:e,parentIframe:r}=t;return e==null?0:r!=null?4:e instanceof HTMLIFrameElement?Lt(e,o)?2:1:0},"getLocatedElementType");var ce=n(o=>{if(o!=null)return Array.isArray(o)?`${o[0]}x${o[1]}`:o},"parseCreativeSize");var Mr=n((o,t,e)=>({splc:o.adUnit.id,unit:ce(t.renderedSize),spos:o.adUnit.position,dvp_qtpid:e,dvp_qtsid:o.uuid}),"getQtTracking");var Lr=n(o=>Object.entries(o).map(([t,e])=>`${t}=${e!=null?e:""}`).join("&"),"getAsQueryString");var Ro="data-dv-gptm-ad-container",yo="dv-gptm-",Ne=n(o=>({attributeName:Ro,attributeValue:yo+o.elementId}),"getAdContainerMarker"),kr=n((o,t)=>{var i;let{attributeName:e,attributeValue:r}=Ne(o);(i=t.element)==null||i.setAttribute(e,r)},"markAdContainer");var qr=n(()=>({dvp_pubaft:1,ee_dp_pubaft:1}),"getFalconTestTracking");var jr=n(o=>{if(o==null)return null;let t=o.querySelectorAll("span[id][data-dv-view]");return t.length!==1?null:t[0]},"lookupCwSpan");var Gr=n((o,t)=>{var i;if(o.element==null)return!1;let e=(i=o.parentIframe)!=null?i:o.element;return!(!(e instanceof HTMLIFrameElement)||Lt(e,t))},"canDetectCreativeWrapper"),Vr=n(o=>{var i;let t=(i=o.parentIframe)!=null?i:o.element;if(!(t instanceof HTMLIFrameElement))return!1;let e=hr(t);return jr(e)!==null},"isCreativeWrapperPresentInIframe");var Qr=n(o=>o,"asStrictString"),Ut=n(o=>o,"castAsStrictString");var Br=n(o=>o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"escapeRegExp");var Eo=["embed","object","link","img","span","iframe","div","canvas","svg"],Fe=n(o=>{let t=Br(o);return Ut(`^${t}$`)},"formatForBtreg"),$r=n((o,t)=>{if(t.element==null)return{btreg:Fe(o.elementId)};let e=Ut(t.element.id),r=Ne(o),i;e===""?i={btreg:Fe(r.attributeValue),btattb:Ut(r.attributeName)}:i={btreg:Fe(e)};let d=t.element.tagName.toLowerCase();return Eo.includes(d)||(i.bttag=Ut(d)),i},"getBtParams");var _o="https://cdn.doubleverify.com/dvtp_src.js",bo="https://cdn.dv.tech/dvbm.js",_t=class{generateMeasurementScriptElement(t,e,r,i,d){var m;((m=e.element)==null?void 0:m.id)===""&&kr(t,e),this.core.get(E).debug(`Generating measurement script element for ${t.elementId}`);let u=this._generateMeasurementScriptURL(t,e,r,i,d);return ur(u)}_truncateElementId(t){return Or(t,30,"~")}_isCreativeWrapperPresent(t){let e=this.core.get(D).getWindow();return Gr(t,e)===!1?null:Vr(t)}_getAdditionalTrackingParams({slot:t,adContainer:e,creative:r,falconTestEnabled:i,adFormatsTargetingDiagnostics:d}){let u=Mr(t,r,this.core.get(b).getVisitUuid()),m=_(_({},this.core.get(Rt).getAdServerTracking(t)),this.core.get(Et).trackCustomMetadata(t)),f=d!=null?wr(d):{},h=_(_(_(_({dvp_uptseid:this._truncateElementId(t.elementId),dvp_gptmle:Dr(this.core.window,e)},Fr(t)),Ur(this._isCreativeWrapperPresent(e))),i?qr():{}),f),S=this.core.get(O).getGlobalParams(),I=this.core.get(O).getSlotParams(t);return _(_(_(_(_({},u),m),h),S),I)}_generateMeasurementScriptURL(t,e,r,i,d){var ft;let u=this.core.get(k).get("FALCON_TEST")==="on",m=u&&this.core.get(k).get("FALCON_TEST_SCRIPT_FLAVOR")==="falcon",f=(ft=t.adUnit)!=null?ft:{},h,S=null,I=e.parentIframe==null?e.element:e.parentIframe.contentDocument,U=$r(t,e),w=U;if(d.length===0)h=U;else{let{adTarget:Ge,diagnostics:Ve}=Pr(d,I);Ge!=null?h=Ge:h=Ve.adTargetingErrorCode!=null?w:U,S=Ve}let Z=_({t2te:0,seltag:"1",cmp:i.cmp,ctx:i.ctx,sadv:r.advertiserId,ord:r.campaignId,litm:r.lineItemId,scrt:r.creativeId,splc:f.id,unit:ce(r.renderedSize)},h),jt=m?{blk:0}:{},fe=this._getAdditionalTrackingParams({slot:t,adContainer:e,creative:r,falconTestEnabled:u,adFormatsTargetingDiagnostics:S}),mt=Lr(_(_(_({},Z),jt),fe));return`${m?bo:_o}#${mt}`}};n(_t,"MeasurementScriptTag"),_t=s([c],_t);var De=class De{constructor(){g(this,"injectionStrategyName");g(this,"injectionType")}_logError(t){return this.core.get(E).error(t),new Error(t)}addMeasurement(t,e){return A(this,null,function*(){if(this.canUseStrategy(t))return this._addMeasurement(t,e);throw this._logError(`Slot ${t.elementId} can't be measured using ${this.injectionStrategyName}`)})}_addMeasurement(t,e){return A(this,null,function*(){try{this._trackStrategy(t);let r=this.core.get(G).getAdFormats(),i=this._createMeasurementScriptTag(t,e,r),d=new Promise((u,m)=>{i.addEventListener("load",()=>{this.core.get(E).info(`Start measuring slot ${t.elementId} using ${this.injectionStrategyName}`),u()}),i.addEventListener("error",()=>m(this._logError(`Error adding measurement to slot ${t.elementId} using ${this.injectionStrategyName}`)))});return this.inject(i,t),d}catch(r){throw this._logError(`Error adding measurement to slot ${t.elementId} using ${this.injectionStrategyName}`)}})}removeMeasurementIfExists(t){this.core.get(E).info(`Stop measuring slot ${t.elementId} using ${this.injectionStrategyName}`)}canUseStrategy(t){return!0}shouldUseParentIframeContainer(t){return!1}_trackStrategy(t){let e=this.core.get(O).getSlotParams(t);e.dvp_gptmit=this.injectionType}_createMeasurementScriptTag(t,e,r){let i=this.core.get(b).getTagInfo(),d=this.core.get(M).getAdContainer(t);return this.shouldUseParentIframeContainer(t)&&d.parentIframe!=null&&(d={element:d.parentIframe}),this.core.get(_t).generateMeasurementScriptElement(t,d,e,i,r)}inject(t,e){throw new Error("Abstract method")}};n(De,"MeasurementInjectionBase");var kt=De;var dt=class extends kt{constructor(){super(...arguments);g(this,"injectionType",0);g(this,"injectionStrategyName","iframe wrapper");g(this,"iframeElements",new P)}addMeasurement(e,r){return super.addMeasurement(e,r)}shouldUseParentIframeContainer(e){return this.core.get(M).getAdContainer(e).parentIframe!=null}inject(e,r){this.core.get(E).debug(`Create measurement iframe wrapper for slot ${r.elementId}`);let i=fr({id:`${br}-${r.elementId}`,data:{slotId:r.uuid,slotAdCount:this.core.get(z).getSlotImpressionCount(r)}}),d=this.core.get(D).getDocument();se(d.body,i),pr(i,e),this.iframeElements.set(r,i)}removeMeasurementIfExists(e){let r=this.iframeElements.get(e);r!==void 0&&(super.removeMeasurementIfExists(e),mr(r),this.iframeElements.delete(e))}};n(dt,"IFrameWrappedMeasurement"),dt=s([c],dt);var gt=class extends kt{constructor(){super(...arguments);g(this,"injectionStrategyName","piggyback");g(this,"injectionType",1)}addMeasurement(e,r){return super.addMeasurement(e,r)}canUseStrategy(e){let{element:r,parentIframe:i}=this.core.get(M).getAdContainer(e);return r!=null&&i!=null}inject(e,r){let{element:i,parentIframe:d}=this.core.get(M).getAdContainer(r);if(i==null)throw new Error(`Cannot get the element of slot ${r.elementId}`);if(d==null)throw new Error(`Cannot get the body of the iframe of slot ${r.elementId}`);se(i,e)}removeMeasurementIfExists(e){return super.removeMeasurementIfExists(e)}};n(gt,"PiggybackMeasurement"),gt=s([c],gt);var ct=class{_trackSelectedVariation(t){let{fraction:e,featureFlags:r}=t,i=this.core.get(k).encodeAsHexString(r),d=`${e.numerator}/${e.denominator}`;this._trackSelectedVariationOnGPTMeasurement(i,d),this._trackSelectedVariationOnCreativeWrapperMeasurement(i,d)}_trackSelectedVariationOnGPTMeasurement(t,e){let r=this.core.get(O).getGlobalParams();r.dvp_gptmvr=t,r.dvp_gptmvrfr=e}_trackSelectedVariationOnCreativeWrapperMeasurement(t,e){this.core.get(T).addUptPageTargeting(ge(de,{dvp_gptmvr:[t],dvp_gptmvrfr:[e]}))}};n(ct,"VariationTracking"),s([p(X,"variationSelected")],ct.prototype,"_trackSelectedVariation",1),ct=s([c],ct);var nt=class extends x{_trackActivationPath(){let t=this.core.get(O).getGlobalParams();t.dvp_pubaap=2}_isEligibleForMeasurement(t){return this.core.get(k).get("GPT_MEASUREMENT")!=="off"&&(t.source==="custom"||this.core.get(F).isAdServerConfigured(t.adUnit.network))}_isReadyForMeasurement(t){return this._isEligibleForMeasurement(t)&&(t.source==="custom"||this.core.get(ot).isDeduplicationReliable(t))}_maybeDisableCreativeWrapper(t){this._isEligibleForMeasurement(t)&&this.core.get(ot).setDeduplicationTargeting(t)}_maybeAddMeasurementOnSlot(t,e){return A(this,null,function*(){if(e==null)return;if(!this._isReadyForMeasurement(t)){this.core.get(E).debug(`Slot ${t.elementId} is not eligible for measurement`);return}let r=!1;this.core.get(G).shouldAvoidPiggybackInjection()||(r=yield this._tryInjectionStrategy(this.core.get(gt),t,e)),r||(r=yield this._tryInjectionStrategy(this.core.get(dt),t,e))})}_tryInjectionStrategy(t,e,r){return A(this,null,function*(){try{return yield t.addMeasurement(e,r),!0}catch(i){return!1}})}_maybeRemoveMeasurementOnSlot(t){this.core.get(gt).removeMeasurementIfExists(t),this.core.get(dt).removeMeasurementIfExists(t)}};n(nt,"GptMeasurement"),s([C],nt.prototype,"_trackActivationPath",1),s([p(T,"slotDiscovered")],nt.prototype,"_maybeDisableCreativeWrapper",1),s([p(v,"adRendered")],nt.prototype,"_maybeAddMeasurementOnSlot",1),s([p(v,"adRemoved")],nt.prototype,"_maybeRemoveMeasurementOnSlot",1),nt=s([c,q(j),q(at),q(z),q(ct)],nt);var Wr="ccfid",Co="data-cc-id",Kr=`.//script[contains(@id,"${Wr}")]`,Io=n(o=>{if(o==null)throw new Error("Clipcentric script node is null");if(o.hasAttribute("id")===!1)throw new Error("Clipcentric script node does not have an id attribute");let t=o.getAttribute("id");if(t==null)throw new Error("Clipcentric script node id attribute is null");return t.replace(Wr,"")},"extractID"),zr={name:"Clipcentric",id:4,detect:o=>Cr(Kr,o),target:o=>{try{let t=Ue(Kr,o);if(t.length!==1)return null;let e=t[0],r=`^${Io(e)}$`;return{btreg:Ut(r),btattb:Qr(Co)}}catch(t){return null}}};var Yr="21226187",Nt=class{_provideConfig(t){return t!==Yr?(this.core.get(E).error(`Invalid ctx provided for TimeConfig, got ${t}, expected ${Yr}`),{}):{adFormats:[zr]}}};n(Nt,"TimeConfig"),s([p(G,"provideConfig")],Nt.prototype,"_provideConfig",1),Nt=s([c],Nt);var Me="qt_loaded",ue="pts_pid",Hr="pts_sid";var Le=n(o=>[...new Set(o.filter(er).map(t=>t.toLowerCase()))],"getGreenlightSignal");var it=class extends x{_autoInsertPageId(){let t=this.core.get(b);this.core.get(T).setUptPageTargeting({[ue]:[t.getVisitUuid()]})}_autoInsertSlotId(t){t.setUptSlotTargeting({[Hr]:[t.uuid]})}_autoInsertGlobalTargeting(t){this.core.get(T).addUptPageTargeting({[Me]:Le(Object.keys(t))})}_autoInsertSlotTargeting(t,e){t.addUptSlotTargeting({[Me]:Le(Object.keys(e))})}};n(it,"SignalsAutoInsertion"),s([C],it.prototype,"_autoInsertPageId",1),s([p(T,"slotDiscovered")],it.prototype,"_autoInsertSlotId",1),s([p(R,"userTargetingUpdated"),p(R,"pageTargetingUpdated")],it.prototype,"_autoInsertGlobalTargeting",1),s([p(R,"slotTargetingUpdated")],it.prototype,"_autoInsertSlotTargeting",1),it=s([c,q(j)],it);var xo="https://vtrk.doubleverify.com",Xr="dvtag",Po=1,wo=1,Y=class{constructor(){g(this,"sharedDataPoints")}_onAdRequestCompleted(t){if(t.index!==0)return;let{timeoutValue:e,onDvtagReadyCalled:r,callbackCalled:i}=t,d=i!=null?i-r:e;this.fireEvent("ad-request",{cd111:t.status,cm106:t.index,cm107:d,cd112:t.internal?"legacy":"modern"},{sampleInterval:wo})}_handleError(t){this.fireEvent("log",{cd111:"error",cd112:t.message,cd113:t.trace.join("=>")},{sampleInterval:Po})}_getSharedDataPoints(){if(this.sharedDataPoints==null){let t=this.core.get(b),e=this.core.get(Q),r=this.core.get(D),{ctx:i,cmp:d,legacy:u}=t.getTagInfo(),m=r.getHostname(),f=t.getVisitUuid(),h=e.getShortCommitId();this.sharedDataPoints={cd102:h,cd103:"",cd107:f,cd109:u?"legacy":"modern",cd108:"",cd105:i,cd106:d,cd104:m}}return this.sharedDataPoints}fireEvent(t,e,{sampleInterval:r=1,trackerUuid:i=ht(),spoofWrapperId:d=!1}={}){if(Math.random()>=1/r)return;e=vt(_(_({},e),this._getSharedDataPoints()),{cd101:t,cm101:r});let u=vt(_({ec:Xr,ea:e.cd101,ctx:d?Xr:e.cd105,cmp:e.cd106},e),{cid:i,t:"event",v:1,z:i,cd160:i}),m=new URL(xo);for(let[f,h]of Object.entries(u))h!=null&&m.searchParams.set(f,`${h}`);this._sendBeacon(m.href)}_sendBeacon(t){try{typeof(navigator==null?void 0:navigator.sendBeacon)=="function"?navigator.sendBeacon(t):new Image().src=t}catch(e){}}};n(Y,"Events"),s([p(y,"adRequestCompleted")],Y.prototype,"_onAdRequestCompleted",1),s([Ke],Y.prototype,"_handleError",1),Y=s([c],Y);var Oo=ue,J=class{constructor(){g(this,"restoreCount",0)}getRestoreCount(){return this.restoreCount}_restoreTargeting(){for(let t of this.core.get(T).getSlots())t.getAdServerTargeting(Oo).length===0&&(t.forceFlushAllUptTargetingToAdServer(),this.restoreCount+=1)}};n(J,"TargetingRestorer"),s([p(y,"adRequestQueued")],J.prototype,"_restoreTargeting",1),J=s([c],J);var ke=class ke{constructor(){g(this,"total",0);g(this,"dataPoints",0)}push(t){return this.total+=t,this.dataPoints+=1,this}get(){return this.total/this.dataPoints}getRounded(){return Math.round(this.get())}};n(ke,"Average");var Wt=ke;var bt=n(()=>{var o,t,e;return Math.floor((e=(t=(o=window.performance)==null?void 0:o.now)==null?void 0:t.call(o))!=null?e:Date.now())},"perfNowOrDateNow");var qe=class qe{constructor(){g(this,"_firstQueuedAdRequest",1/0);g(this,"_lastQueuedAdRequest",-1/0);g(this,"_firstReleasedAdRequest",1/0);g(this,"_lastReleasedAdRequest",-1/0);g(this,"_lastReleasedAdRequestTime",null)}setAdRequestQueued(t){this._firstQueuedAdRequest=Math.min(this._firstQueuedAdRequest,t),this._lastQueuedAdRequest=Math.max(this._lastQueuedAdRequest,t)}setAdRequestReleased(t){this._firstReleasedAdRequest=Math.min(this._firstReleasedAdRequest,t),this._lastReleasedAdRequest=Math.max(this._lastReleasedAdRequest,t),this._lastReleasedAdRequestTime=bt()}getLastQueuedAdRequest(){return Number.isFinite(this._lastQueuedAdRequest)?this._lastQueuedAdRequest:null}getLastReleasedAdRequest(){return Number.isFinite(this._lastReleasedAdRequest)?this._lastReleasedAdRequest:null}getLastReleasedAdRequestTime(){return this._lastReleasedAdRequestTime}getLastSuccessfulAdRequest(){let t=Math.max(this._firstQueuedAdRequest,this._firstReleasedAdRequest),e=Math.min(this._lastQueuedAdRequest,this._lastReleasedAdRequest);return e<t?null:e}};n(qe,"SlotAdRequestTracker");var me=qe;var pe=(u=>(u.UNKNOWN="UNKNOWN",u.SEEN="SEEN",u.NOT_READY="NOT_READY",u.POSSIBLE_TIMEOUT="POSSIBLE_TIMEOUT",u.PREV_READY="PREV_READY",u.READY="READY",u))(pe||{});var je="dv_upt_slot_ready",Uo=["https://securepubads.g.doubleclick.net/gampad/ads?","https://pagead2.googlesyndication.com/gampad/ads?"],V=class{constructor(){g(this,"plugins",{onSlotRequested:()=>[],onSlotRequestValidated:()=>[]});g(this,"validateAdRequests",!1);g(this,"lastAdRequestQueued",null);g(this,"lastAdRequestReleased",null);g(this,"state",{adRequestTracker:new P,triggered:new P})}_getSlotAdRequestTracker(t){let e=this.state.adRequestTracker.get(t);return e==null&&(e=new me,this.state.adRequestTracker.set(t,e)),e}_onAdRequestQueued({index:t}){this.lastAdRequestQueued=t;for(let e of this.core.get(T).getSlots())this._getSlotAdRequestTracker(e).setAdRequestQueued(t),this.state.triggered.set(e,!1)}_onAdRequestBeforeRelease({index:t}){this.lastAdRequestReleased=t;for(let e of this.core.get(T).getSlots())this._getSlotAdRequestTracker(e).setAdRequestReleased(t),this.validateAdRequests&&e.setUptSlotTargeting({[je]:["1"]})}_onSlotDiscovered(t,e){var r;e===0&&this._getSlotAdRequestTracker(t).setAdRequestQueued((r=this.lastAdRequestQueued)!=null?r:0)}_determineReadyState(t){let e=this._getSlotAdRequestTracker(t),r=e.getLastQueuedAdRequest(),i=e.getLastReleasedAdRequest(),d=e.getLastSuccessfulAdRequest();return r==null&&i==null?"UNKNOWN":this.lastAdRequestQueued==null?d==null?"SEEN":"PREV_READY":this.lastAdRequestReleased==null||this.lastAdRequestReleased<this.lastAdRequestQueued?d==null?"NOT_READY":"PREV_READY":"READY"}getSlotReadyStateOnAdServerAdRequest(t){let e=this._determineReadyState(t);if(e==="READY"){if(this.state.triggered.get(t)===!0)return{readyState:"PREV_READY"};this.state.triggered.set(t,!0);let r=this._getSlotAdRequestTracker(t).getLastReleasedAdRequestTime();return{readyState:e,readyFor:bt()-r}}return{readyState:e}}_onSlotRequested(t){let{readyState:e,readyFor:r}=this.getSlotReadyStateOnAdServerAdRequest(t);this.validateAdRequests&&t.setUptSlotTargeting({[je]:["0"]}),this.plugins.onSlotRequested(t,e,r)}enableAdRequestValidation(){if(!this.validateAdRequests)try{let t=this._processResourceRequest.bind(this);new PerformanceObserver(r=>r.getEntries().forEach(t)).observe({type:"resource"}),this.validateAdRequests=!0}catch(t){}}_processResourceRequest(t){var e,r,i;try{if(Uo.every(m=>!t.name.startsWith(m)))return;let u=(r=(e=new URL(t.name).searchParams.get("prev_scp"))==null?void 0:e.split("|"))!=null?r:[];for(let m of u){let h=((i=new URLSearchParams(m).get(je))==null?void 0:i[0])==="1";this.plugins.onSlotRequestValidated(h)}}catch(d){}}};n(V,"SlotReadinessTracker"),s([p(y,"adRequestQueued")],V.prototype,"_onAdRequestQueued",1),s([p(y,"adRequestBeforeRelease"),p(y,"adRequestTimedOut")],V.prototype,"_onAdRequestBeforeRelease",1),s([p(T,"slotDiscovered")],V.prototype,"_onSlotDiscovered",1),s([p(v,"adRequested")],V.prototype,"_onSlotRequested",1),V=s([c],V);var No="implcheck",Fo=1e-4,Do=5e3,Mo=5,H=class{constructor(){g(this,"enabled",!1);g(this,"totalInternalAdRequestQueuedCount",0);g(this,"totalAdRequestsCompletedCount",0);g(this,"totalSlotsRequestedCount",0);g(this,"totalSlotsRequestedOkCount",0);g(this,"totalTimeoutCount",0);g(this,"trackersSent",0);g(this,"totalValidatedAdServerRequests",{ok:0,notOk:0});g(this,"lastOnDvtagReadyCall",NaN);g(this,"slotReqAvgTimeSinceCall",new Wt);g(this,"slotReqAvgTimeSinceDone",new Wt);g(this,"batch",null)}isDebugForceEnabled(){return!1}_initialize(){this.enabled=this.core.get(H).isDebugForceEnabled()||Math.random()<Fo,this.enabled&&this.core.get(V).enableAdRequestValidation()}_onAdRequestQueued(t){this.enabled&&(this.lastOnDvtagReadyCall=bt(),t.internal&&(this.totalInternalAdRequestQueuedCount+=1))}_onAdRequestCompleted(t){this.enabled&&(this.totalAdRequestsCompletedCount+=1,(t.status==="tag-timeout"||t.status==="queue-timeout")&&(this.totalTimeoutCount+=1))}_onSlotRequested(t,e,r){if(!this.enabled)return;let i=this._getOrStartBatch();this.totalSlotsRequestedCount+=1,e==="READY"&&(this.totalSlotsRequestedOkCount+=1),i.slots[e].push(t.elementId),r!=null&&(this.slotReqAvgTimeSinceDone.push(r),this.slotReqAvgTimeSinceCall.push(bt()-this.lastOnDvtagReadyCall));let d=t.validateAdServerTargeting();d===1?i.targeting.extendedCount+=1:d===0&&(i.targeting.reducedCount+=1)}_onSlotRequestValidated(t){t?this.totalValidatedAdServerRequests.ok+=1:this.totalValidatedAdServerRequests.notOk+=1}_sendTracker(){let t=this.core.get(J).getRestoreCount(),{slots:e,targeting:r,start:i}=this._getOrStartBatch(),d={cd110:e.READY.join(),cd111:e.PREV_READY.join(),cd112:e.SEEN.join(),cd113:e.NOT_READY.join(),cd114:e.UNKNOWN.join(),cd115:e.POSSIBLE_TIMEOUT.join(),cm106:this.trackersSent,cm107:i,cm109:this.totalTimeoutCount,cm110:this.slotReqAvgTimeSinceCall.getRounded(),cm111:this.slotReqAvgTimeSinceDone.getRounded(),cm112:this.totalSlotsRequestedOkCount,cm113:this.totalValidatedAdServerRequests.ok,cm114:this.totalValidatedAdServerRequests.notOk,cm115:t,cm116:this.totalAdRequestsCompletedCount,cm117:this.totalInternalAdRequestQueuedCount,cm118:this.totalSlotsRequestedCount,cm119:r.reducedCount,cm120:r.extendedCount};this.core.get(Y).fireEvent(No,d),this.batch=null,this.trackersSent+=1,this.trackersSent>=Mo&&(this.enabled=!1)}_getOrStartBatch(){return this.batch==null&&(this.batch={start:bt(),slots:Object.fromEntries(Object.values(pe).map(t=>[t,[]])),targeting:{extendedCount:0,reducedCount:0}},setTimeout(()=>this._sendTracker(),Do)),this.batch}};n(H,"ImplementationValidator"),s([C],H.prototype,"_initialize",1),s([p(y,"adRequestQueued")],H.prototype,"_onAdRequestQueued",1),s([p(y,"adRequestCompleted")],H.prototype,"_onAdRequestCompleted",1),s([p(V,"onSlotRequested")],H.prototype,"_onSlotRequested",1),s([p(V,"onSlotRequestValidated")],H.prototype,"_onSlotRequestValidated",1),H=s([c],H);var st=class{_defineSlot(t,e={}){if(typeof t!="string"||e==null||typeof e!="object")return;let r={id:B(e.id),network:B(e.network),sizes:e.sizes!=null?Dt(e.sizes):void 0,position:B(e.position)};this.core.get(T).createSlot("custom",0,t,r)}_adRendered(t,e){if(typeof t!="string"||e==null||typeof e!="object")return;let r=this.core.get(T).getSlot("custom",t);if(r==null)return;let i={advertiserId:B(e.advertiserId),campaignId:B(e.campaignId),creativeId:B(e.creativeId),lineItemId:B(e.lineItemId),renderedSize:ie(e.renderedSize)};this.core.get(v).setAdRendered(r,i)}_adRemoved(t){if(typeof t!="string")return;let e=this.core.get(T).getSlot("custom",t);e!=null&&this.core.get(v).setAdRemoved(e)}_getTargeting(t){let e=this.core.get(T);if(typeof t!="string")return e.getUptPageTargeting();let r=e.getSlot("custom",t);return r==null?e.getUptPageTargeting():r.getUptTargeting()}};n(st,"CustomAdServer"),s([Ft("defineSlot")],st.prototype,"_defineSlot",1),s([Ft("getTargeting")],st.prototype,"_getTargeting",1),st=s([c],st);var ut=class{constructor(){g(this,"initialized",!1);g(this,"size",0)}_initialize(){return A(this,null,function*(){if(yield Promise.resolve(),this.initialized)return;this.initialized=!0,this.core.dvtag.cmd instanceof Array||(this.core.dvtag.cmd=[]);let t=this.core.dvtag.cmd;this.core.dvtag.cmd={push:(...e)=>{for(let r of e)try{r()}catch(i){}return this.size+=e.length,this.size}},this.core.dvtag.cmd.push(...t)})}};n(ut,"CommandBuffer"),s([C],ut.prototype,"_initialize",1),ut=s([c],ut);var qt=class{};n(qt,"HouseHold"),qt=s([c,q(y),q(ut),q(Y),q(st),q(J)],qt);if(window.dvtag==null||window.dvtag._core==null)try{new Gt(Ee,window)}catch(o){}})();
